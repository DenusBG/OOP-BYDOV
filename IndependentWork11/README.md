# üìë –°–∞–º–æ—Å—Ç—ñ–π–Ω–∞ –†–æ–±–æ—Ç–∞ ‚Ññ11: –ö–µ–π—Å–∏ Polly/Retry: –ö–æ—Ä–æ—Ç–∫–∏–π –ó–≤—ñ—Ç

### –¢–µ–º–∞: –î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è —Ç–∞ –∞–Ω–∞–ª—ñ–∑ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Polly
### –ú–µ—Ç–∞: –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫ –≤—ñ–¥–º–æ–≤–æ—Å—Ç—ñ–π–∫–æ—Å—Ç—ñ (Resilience) Polly —É .NET-–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö.

---

## üöÄ –ó–∞–≥–∞–ª—å–Ω—ñ –í–∏—Å–Ω–æ–≤–∫–∏ —â–æ–¥–æ Polly

–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ **Polly** —î –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è **–ø–æ–ª—ñ—Ç–∏–∫ –≤—ñ–¥–º–æ–≤–æ—Å—Ç—ñ–π–∫–æ—Å—Ç—ñ** (Resilience) —É .NET-–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Polly –¥–æ–∑–≤–æ–ª—è—î:
1.  **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—è** –ø—ñ—Å–ª—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –∑–±–æ—ó–≤ (–º–µ—Ä–µ–∂–µ–≤–∏—Ö, IO, DB).
2.  **–ó–∞–ø–æ–±—ñ–≥–∞—Ç–∏ –∫–∞—Å–∫–∞–¥–Ω–∏–º –∑–±–æ—è–º**, —ñ–∑–æ–ª—é—é—á–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –≤—ñ–¥ –∫—Ä–∏—Ç–∏—á–Ω–æ –Ω–µ—Å–ø—Ä–∞–≤–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤.
3.  **–ï–∫–æ–Ω–æ–º–∏—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏**, —É–Ω–∏–∫–∞—é—á–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ–≥–æ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –Ω–∞ "–∑–∞–≤–∏—Å–∞—é—á–∏—Ö" –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö.

---

## 1. –°—Ü–µ–Ω–∞—Ä—ñ–π: –î–æ—Å—Ç—É–ø –¥–æ –ó–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API (–ü–æ–ª—ñ—Ç–∏–∫–∞ Retry)

### üìù –ü—Ä–æ–±–ª–µ–º–∞
–ó–æ–≤–Ω—ñ—à–Ω—ñ–π REST API –º–æ–∂–µ –∫–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –ø–æ–º–∏–ª–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `503 Service Unavailable`). –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Å–ø—Ä–æ–±—É –∑ —Ä–æ–∑—É–º–Ω–æ—é –ø–∞—É–∑–æ—é.

### üí° –ü–æ–ª—ñ—Ç–∏–∫–∞ Polly: Retry –∑ –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–π–Ω–æ—é –ó–∞—Ç—Ä–∏–º–∫–æ—é (`WaitAndRetry`)
* **–û–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è:** –ó–±—ñ–π, –π–º–æ–≤—ñ—Ä–Ω–æ, —î —Ç–∏–º—á–∞—Å–æ–≤–∏–º. –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–π–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ (`2^n` —Å–µ–∫—É–Ω–¥–∏) –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—é –≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞–Ω–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É.
* **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:** 3 –ø–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏, –æ–±—Ä–æ–±–∫–∞ `HttpRequestException`.

### –§—Ä–∞–≥–º–µ–Ω—Ç –ö–æ–¥—É (`Program.cs`):

```csharp
var retryPolicy = Policy
    .Handle<HttpRequestException>() // –û–±—Ä–æ–±–ª—è—î–º–æ –º–µ—Ä–µ–∂–µ–≤—ñ –ø–æ–º–∏–ª–∫–∏
    .WaitAndRetry(
        3, // –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏
        retryAttempt => TimeSpan.FromSeconds(Math.Pow(2, retryAttempt)), // –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–π–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞: 2—Å, 4—Å, 8—Å
        (exception, timeSpan, retryCount, context) =>
        {
            Console.WriteLine($"[LOG] üîÑ Retry {retryCount} after {timeSpan.TotalSeconds:F1}s due to: {exception.Message}");
        }
    );
try
{
    string result = retryPolicy.Execute(() => CallExternalApi("[https://api.external.com/data](https://api.external.com/data)"));
    // ... –£—Å–ø—ñ—à–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
}
catch (Exception ex)
{
    // ... –ü—Ä–æ–≤–∞–ª –ø—ñ—Å–ª—è –≤—Å—ñ—Ö —Å–ø—Ä–æ–±
}